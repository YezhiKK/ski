<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkiWuhan - 2026 拼车看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .glass-nav { background: rgba(30, 64, 175, 0.9); backdrop-filter: blur(10px); }
        .resort-header { @apply flex justify-between items-center p-5 rounded-t-[2rem] text-white shadow-inner; }
        .feed-container { @apply p-4 bg-white/50 rounded-b-[2rem] border-x border-b border-slate-100 mb-8 min-h-[60px]; }
        .card-pop { transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card-pop:hover { transform: translateY(-3px) scale(1.02); }
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #1e40af; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">

    <nav class="glass-nav text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-xl">
        <div>
            <h1 class="text-xl font-black italic tracking-tighter uppercase leading-none">SKI WUHAN</h1>
            <p class="text-[8px] font-bold tracking-[0.2em] opacity-70">RIDERS COMMUNITY</p>
        </div>
        <button onclick="toggleModal('publish-modal')" class="bg-white text-blue-800 px-6 py-2.5 rounded-full text-xs font-black shadow-lg hover:shadow-white/20 active:scale-95 transition-all">
            + 发帖
        </button>
    </nav>

    <main class="max-w-4xl mx-auto p-4 mt-6">
        
        <section class="card-pop">
            <div class="resort-header bg-gradient-to-r from-blue-700 to-blue-500">
                <h3 class="font-black text-xl italic uppercase">甘露山滑雪场</h3>
                <a href="https://uri.amap.com/marker?position=114.28,30.88&name=甘露山滑雪场" target="_blank" class="text-[10px] bg-white/20 hover:bg-white/40 px-3 py-1.5 rounded-lg font-bold">
                    <i class="fas fa-location-arrow mr-1"></i> 具体位置
                </a>
            </div>
            <div id="feed-甘露山滑雪场" class="feed-container"></div>
        </section>

        <section class="card-pop">
            <div class="resort-header bg-gradient-to-r from-blue-500 to-cyan-400">
                <h3 class="font-black text-xl italic uppercase">WS热雪奇迹</h3>
                <a href="#" target="_blank" class="text-[10px] bg-white/20 hover:bg-white/40 px-3 py-1.5 rounded-lg font-bold">
                    <i class="fas fa-location-arrow mr-1"></i> 具体位置
                </a>
            </div>
            <div id="feed-WS热雪奇迹" class="feed-container"></div>
        </section>

        <section class="card-pop">
            <div class="resort-header bg-gradient-to-r from-teal-500 to-emerald-400">
                <h3 class="font-black text-xl italic uppercase">武汉冰雪中心</h3>
                <a href="#" target="_blank" class="text-[10px] bg-white/20 hover:bg-white/40 px-3 py-1.5 rounded-lg font-bold">
                    <i class="fas fa-location-arrow mr-1"></i> 具体位置
                </a>
            </div>
            <div id="feed-武汉冰雪中心" class="feed-container"></div>
        </section>

        <section class="card-pop">
            <div class="resort-header bg-gradient-to-r from-indigo-700 to-purple-500">
                <h3 class="font-black text-xl italic uppercase">绿葱坡滑雪场</h3>
                <a href="#" target="_blank" class="text-[10px] bg-white/20 hover:bg-white/40 px-3 py-1.5 rounded-lg font-bold">
                    <i class="fas fa-location-arrow mr-1"></i> 具体位置
                </a>
            </div>
            <div id="feed-绿葱坡滑雪场" class="feed-container"></div>
        </section>

        <section class="card-pop">
            <div class="resort-header bg-gradient-to-r from-slate-800 to-slate-600">
                <h3 class="font-black text-xl italic uppercase">桃花冲滑雪场</h3>
                <a href="#" target="_blank" class="text-[10px] bg-white/20 hover:bg-white/40 px-3 py-1.5 rounded-lg font-bold">
                    <i class="fas fa-location-arrow mr-1"></i> 具体位置
                </a>
            </div>
            <div id="feed-桃花冲滑雪场" class="feed-container"></div>
        </section>

        <section class="card-pop">
            <div class="resort-header bg-gradient-to-r from-orange-600 to-amber-500">
                <h3 class="font-black text-xl italic uppercase">伏牛山滑雪场</h3>
                <a href="#" target="_blank" class="text-[10px] bg-white/20 hover:bg-white/40 px-3 py-1.5 rounded-lg font-bold">
                    <i class="fas fa-location-arrow mr-1"></i> 具体位置
                </a>
            </div>
            <div id="feed-伏牛山滑雪场" class="feed-container"></div>
        </section>

    </main>

    <div id="publish-modal" class="hidden fixed inset-0 bg-slate-900/80 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] w-full max-w-md p-8 shadow-2xl relative overflow-hidden">
            <h3 class="text-2xl font-black mb-6 italic text-blue-900 uppercase">Post a Trip</h3>
            <form id="carpoolForm" class="space-y-4">
                <select id="resort" class="w-full bg-slate-100 border-none rounded-2xl p-4 text-sm font-bold">
                    <option>甘露山滑雪场</option>
                    <option>WS热雪奇迹</option>
                    <option>武汉冰雪中心</option>
                    <option>绿葱坡滑雪场</option>
                    <option>桃花冲滑雪场</option>
                    <option>伏牛山滑雪场</option>
                </select>
                <div class="grid grid-cols-2 gap-3">
                    <input type="text" id="area" placeholder="出发地" class="bg-slate-100 border-none rounded-2xl p-4 text-sm font-bold">
                    <input type="text" id="wechat" placeholder="微信号" class="bg-slate-100 border-none rounded-2xl p-4 text-sm font-bold">
                </div>
                <input type="text" id="time" placeholder="发车时间 (如: 1.28 周六 08:00)" class="w-full bg-slate-100 border-none rounded-2xl p-4 text-sm font-bold">
                <div class="flex gap-2">
                    <button type="button" onclick="submitForm()" id="submitBtn" class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg uppercase tracking-widest">发布行程</button>
                    <button type="button" onclick="toggleModal('publish-modal')" class="px-6 bg-slate-100 text-slate-400 rounded-2xl font-bold">取消</button>
                </div>
            </form>
        </div>
    </div>

    <div id="contact-modal" class="hidden fixed inset-0 bg-slate-900/80 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] w-full max-w-xs p-8 text-center shadow-2xl">
            <h3 id="contact-name" class="font-black text-xl mb-4 italic">车主微信</h3>
            <div class="bg-slate-50 py-6 px-2 rounded-3xl border-2 border-dashed border-blue-100 mb-6">
                <span id="contact-wx" class="text-2xl font-black text-blue-600 select-all tracking-tight"></span>
            </div>
            <button onclick="toggleModal('contact-modal')" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold text-xs uppercase tracking-widest">我知道了</button>
        </div>
    </div>

    <script>
        // --- 请在此填入你的 Token 逻辑 ---
      const part1 = "ghp_zuKgFIcXPDbm4aq2kFVgY"; // Token 的前一半
const part2 = "eKB0z9ZED3PfBMZ"; // Token 的后一半

const G_TOKEN = part1 + part2; 
const G_REPO = "yezhikk/ski";
    

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }

        function contactOwner(name, wx) {
            document.getElementById('contact-name').innerText = name + ' 车主';
            document.getElementById('contact-wx').innerText = wx;
            toggleModal('contact-modal');
        }

        async function submitForm() {
            const btn = document.getElementById('submitBtn');
            const resort = document.getElementById('resort').value;
            const area = document.getElementById('area').value;
            const wechat = document.getElementById('wechat').value;
            const time = document.getElementById('time').value;

            if(!wechat) { alert("请填写微信"); return; }
            btn.disabled = true;
            btn.innerHTML = '<span class="loader"></span> 同步中';

            try {
                const response = await fetch(`https://api.github.com/repos/${G_REPO}/issues`, {
                    method: 'POST',
                    headers: { 'Authorization': `token ${G_TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: `${area} | ${resort} | ${time} | ${wechat}`, labels: ['拼车'] })
                });
                if (response.ok) { toggleModal('publish-modal'); loadIssues(); }
            } catch (err) { alert('发布失败，请检查设置'); }
            finally { btn.disabled = false; btn.innerText = '发布行程'; }
        }

        async function loadIssues() {
            const sections = {
                '甘露山滑雪场': document.getElementById('feed-甘露山滑雪场'),
                'WS热雪奇迹': document.getElementById('feed-WS热雪奇迹'),
                '武汉冰雪中心': document.getElementById('feed-武汉冰雪中心'),
                '绿葱坡滑雪场': document.getElementById('feed-绿葱坡滑雪场'),
                '桃花冲滑雪场': document.getElementById('feed-桃花冲滑雪场'),
                '伏牛山滑雪场': document.getElementById('feed-伏牛山滑雪场')
            };

            Object.values(sections).forEach(el => { if(el) el.innerHTML = '<p class="text-[10px] text-slate-300 font-bold p-4 animate-pulse">SYNCING...</p>'; });

            try {
                const res = await fetch(`https://api.github.com/repos/${G_REPO}/issues?labels=拼车&state=open&t=${Date.now()}`);
                const issues = await res.json();
                
                Object.values(sections).forEach(el => { if(el) el.innerHTML = ''; });

                issues.forEach(issue => {
                    const parts = issue.title.split('|').map(p => p.trim());
                    if(parts.length < 4) return;
                    const [area, resortName, time, wechat] = parts;

                    const card = `
                        <div class="bg-white rounded-2xl p-4 mb-3 flex justify-between items-center shadow-sm border border-slate-50 card-pop">
                            <div class="flex items-center gap-3">
                                <span class="bg-slate-100 text-slate-600 text-[9px] font-black px-2 py-1 rounded italic">${area}</span>
                                <p class="text-sm font-black text-slate-700">${time}</p>
                            </div>
                            <button onclick="contactOwner('${resortName}', '${wechat}')" class="bg-slate-900 text-white px-5 py-2 rounded-xl text-[10px] font-black uppercase transition-all hover:bg-blue-600">联系</button>
                        </div>
                    `;
                    if(sections[resortName]) sections[resortName].innerHTML += card;
                });

                Object.keys(sections).forEach(key => {
                    if(sections[key].innerHTML === '') {
                        sections[key].innerHTML = '<p class="text-[10px] text-slate-300 font-bold p-4 uppercase tracking-widest">暂无活跃行程</p>';
                    }
                });
            } catch (e) { console.error(e); }
        }
        window.onload = loadIssues;
    </script>
</body>
</html>
