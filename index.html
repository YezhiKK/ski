<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkiWuhan - æ­¦æ±‰æ»‘é›ªæ‹¼è½¦åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .ski-blue { background: #1e40af; }
        .custom-shadow { box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1); }
        .modal-enter { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #1e40af; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .resort-card { border-left: 8px solid #1e40af; transition: all 0.3s ease; }
        .resort-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">

    <nav class="ski-blue text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-lg">
        <h1 class="text-xl font-black italic tracking-tighter uppercase">SKI WUHAN ğŸ‚</h1>
        <button onclick="toggleModal('publish-modal')" class="bg-white text-blue-800 px-5 py-2 rounded-full text-xs font-black shadow-xl hover:bg-blue-50 transition-all">
            + å‘å¸ƒæ‹¼è½¦
        </button>
    </nav>

    <main class="max-w-4xl mx-auto p-4 space-y-12 mt-4">
        
        <div class="text-center py-6">
            <h2 class="text-3xl font-black text-blue-900 mb-2 tracking-tight uppercase italic">Ride With Us</h2>
            <p class="text-[10px] text-slate-400 font-bold tracking-[0.3em] uppercase">é›ªåœºæ”»ç•¥ Â· å®æ—¶æ‹¼è½¦ Â· è‡ªåŠ¨åŒæ­¥</p>
        </div>

        <section class="space-y-4">
            <div class="resort-card bg-white rounded-[2rem] p-6 custom-shadow relative overflow-hidden">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="font-black text-2xl text-slate-800 italic">ç”˜éœ²å±±æ»‘é›ªåœº</h3>
                        <p class="text-[10px] font-bold text-blue-600 tracking-widest uppercase">ğŸ“ é»„é™‚åŒºç›˜é¾™åŸ Â· å®¤å†…åœº</p>
                    </div>
                    <span class="bg-blue-50 text-blue-700 text-[10px] font-black px-3 py-1 rounded-full border border-blue-100">ä¸“ä¸šçº§å…¬å›­</span>
                </div>
                <div class="grid grid-cols-3 gap-2 text-center mb-4">
                    <div class="bg-slate-50 p-2 rounded-xl"><p class="text-[9px] text-slate-400 font-bold">è½å·®</p><p class="text-sm font-black text-slate-700">73m</p></div>
                    <div class="bg-slate-50 p-2 rounded-xl"><p class="text-[9px] text-slate-400 font-bold">å¡åº¦</p><p class="text-sm font-black text-slate-700">21Â°</p></div>
                    <div class="bg-slate-50 p-2 rounded-xl"><p class="text-[9px] text-slate-400 font-bold">å®šä½</p><p class="text-sm font-black text-slate-700">ç»ƒæ´»/å…¬å›­</p></div>
                </div>
            </div>
            <div id="feed-ç”˜éœ²å±±æ»‘é›ªåœº" class="space-y-3 px-2">
                <p class="text-[10px] text-slate-300 font-bold animate-pulse uppercase ml-4">Loading trips...</p>
            </div>
        </section>

        <section class="space-y-4">
            <div class="resort-card bg-white rounded-[2rem] p-6 custom-shadow relative overflow-hidden" style="border-left-color: #3b82f6;">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="font-black text-2xl text-slate-800 italic">WSçƒ­é›ªå¥‡è¿¹</h3>
                        <p class="text-[10px] font-bold text-blue-400 tracking-widest uppercase">ğŸ“ æ­¦æ˜Œæ¢¦æ—¶ä»£ 8L Â· å®¤å†…åœº</p>
                    </div>
                    <span class="bg-blue-50 text-blue-400 text-[10px] font-black px-3 py-1 rounded-full border border-blue-100">åœ°é“ç›´è¾¾</span>
                </div>
                <p class="text-xs text-slate-500 italic">æ’æ¸©èˆ’é€‚ï¼Œé€‚åˆæ–°æ‰‹æ•™å­¦åŠå¹³æ—¥å¤œåœºç»ƒä¹ ã€‚</p>
            </div>
            <div id="feed-WSçƒ­é›ªå¥‡è¿¹" class="space-y-3 px-2"></div>
        </section>

        <section class="space-y-4">
            <div class="resort-card bg-white rounded-[2rem] p-6 custom-shadow relative overflow-hidden" style="border-left-color: #4338ca;">
                <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 class="font-black text-2xl text-indigo-900 italic">æ©æ–½ç»¿è‘±å¡æ»‘é›ªåœº</h3>
                        <p class="text-[10px] font-bold text-indigo-400 tracking-widest uppercase">ğŸ“ æ©æ–½å·´ä¸œ Â· å®¤å¤–é«˜å±±</p>
                    </div>
                    <span class="bg-indigo-50 text-indigo-700 text-[10px] font-black px-3 py-1 rounded-full border border-indigo-100">é„‚è¥¿ååœº</span>
                </div>
                <p class="text-xs text-slate-500 italic">9æ¡é›ªé“ï¼Œäº‘æµ·æ™¯è§‚ï¼Œå»ºè®®ç»„å›¢æˆ–è‡ªé©¾æ‹¼è½¦å‰å¾€ã€‚</p>
            </div>
            <div id="feed-ç»¿è‘±å¡æ»‘é›ªåœº" class="space-y-3 px-2"></div>
        </section>

        <div class="mt-8 p-6 bg-blue-50 rounded-[2.5rem] text-center border border-blue-100">
            <p class="text-blue-800 font-black mb-3 text-sm italic">Need help or join community?</p>
            <div class="bg-white px-6 py-3 rounded-2xl border-2 border-dashed border-blue-200 inline-block">
                <p class="text-[10px] text-gray-400 font-bold uppercase mb-1">WeChat Assistant</p>
                <p class="text-xl font-black text-blue-600 select-all tracking-tight">Yezkel-21</p>
            </div>
        </div>
    </main>

    <div id="publish-modal" class="hidden fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] w-full max-w-md p-8 modal-enter shadow-2xl relative">
            <button onclick="toggleModal('publish-modal')" class="absolute right-6 top-6 text-slate-300 hover:text-slate-900"><i class="fas fa-times text-xl"></i></button>
            <h3 class="text-2xl font-black mb-1 italic text-blue-900 uppercase">Post a Trip</h3>
            <p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest mb-6 border-b pb-4">å‘å¸ƒä¿¡æ¯ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨å¯¹åº”é›ªåœºä¸‹æ–¹</p>
            
            <form id="carpoolForm" class="space-y-4 text-left">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2">ç›®çš„åœ°é›ªåœº</label>
                    <select id="resort" class="w-full bg-slate-50 border-none rounded-2xl p-4 mt-1 text-sm font-bold focus:ring-2 focus:ring-blue-500">
                        <option>ç”˜éœ²å±±æ»‘é›ªåœº</option>
                        <option>WSçƒ­é›ªå¥‡è¿¹</option>
                        <option>ç»¿è‘±å¡æ»‘é›ªåœº</option>
                        <option>æ¡ƒèŠ±å†²æ»‘é›ªåœº</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2">å‡ºå‘åœ°</label>
                        <input type="text" id="area" placeholder="å¦‚ï¼šæ±Ÿå²¸åŒº" class="w-full bg-slate-50 border-none rounded-2xl p-4 mt-1 text-sm font-bold">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2">å¾®ä¿¡å·</label>
                        <input type="text" id="wechat" placeholder="å¿…å¡«" class="w-full bg-slate-50 border-none rounded-2xl p-4 mt-1 text-sm font-bold">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2">å‘è½¦æ—¶é—´/å¤‡æ³¨</label>
                    <input type="text" id="time" placeholder="å¦‚ï¼š1.27 08:30" class="w-full bg-slate-50 border-none rounded-2xl p-4 mt-1 text-sm font-bold">
                </div>
                <button type="button" id="submitBtn" onclick="submitForm()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg mt-4 uppercase tracking-widest">ç¡®è®¤å‘å¸ƒ</button>
            </form>
        </div>
    </div>

    <div id="contact-modal" class="hidden fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] w-full max-w-xs p-8 modal-enter shadow-2xl text-center">
            <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4"><i class="fab fa-weixin text-3xl"></i></div>
            <h3 id="contact-name" class="font-black text-xl mb-1 text-slate-800 italic">è½¦ä¸»å¾®ä¿¡</h3>
            <div class="bg-slate-50 py-4 px-2 rounded-2xl border-2 border-dashed border-slate-200 mb-6">
                <span id="contact-wx" class="text-2xl font-black text-blue-600 select-all tracking-tight"></span>
            </div>
            <button onclick="toggleModal('contact-modal')" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold text-xs uppercase tracking-widest">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒé…ç½®ï¼ˆè¯·å¡«å†™ä½ çš„ä¿¡æ¯ï¼‰ ---
  const part1 = "ghp_zuKgFIcXPDbm4aq2kFVgY"; // Token çš„å‰ä¸€åŠ
const part2 = "eKB0z9ZED3PfBMZ"; // Token çš„åä¸€åŠ

const G_TOKEN = part1 + part2; 
const G_REPO = "yezhikk/ski";

        function toggleModal(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        function contactOwner(name, wx) {
            document.getElementById('contact-name').innerText = name + ' è½¦ä¸»';
            document.getElementById('contact-wx').innerText = wx;
            toggleModal('contact-modal');
        }

        async function submitForm() {
            const btn = document.getElementById('submitBtn');
            const resort = document.getElementById('resort').value;
            const area = document.getElementById('area').value;
            const wechat = document.getElementById('wechat').value;
            const time = document.getElementById('time').value;

            if(!wechat) { alert("è¯·å¡«å†™å¾®ä¿¡å·"); return; }
            btn.disabled = true;
            btn.innerHTML = '<span class="loader"></span> åŒæ­¥ä¸­...';

            const title = `${area} | ${resort} | ${time} | ${wechat}`;

            try {
                const response = await fetch(`https://api.github.com/repos/${G_REPO}/issues`, {
                    method: 'POST',
                    headers: { 'Authorization': `token ${G_TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: title, labels: ['æ‹¼è½¦'] })
                });

                if (response.ok) {
                    alert('å‘å¸ƒæˆåŠŸï¼è¡Œç¨‹å·²åŒæ­¥ã€‚');
                    toggleModal('publish-modal');
                    loadIssues(); 
                } else { throw new Error(); }
            } catch (err) {
                alert('æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥Tokenæƒé™æˆ–ä»“åº“è®¾ç½®');
            } finally {
                btn.disabled = false;
                btn.innerText = 'ç¡®è®¤å‘å¸ƒ';
            }
        }

        async function loadIssues() {
            const sections = {
                'ç”˜éœ²å±±æ»‘é›ªåœº': document.getElementById('feed-ç”˜éœ²å±±æ»‘é›ªåœº'),
                'WSçƒ­é›ªå¥‡è¿¹': document.getElementById('feed-WSçƒ­é›ªå¥‡è¿¹'),
                'ç»¿è‘±å¡æ»‘é›ªåœº': document.getElementById('feed-ç»¿è‘±å¡æ»‘é›ªåœº')
            };

            // å…ˆæ¸…ç©ºæ‰€æœ‰åŠ¨æ€åˆ—è¡¨
            Object.values(sections).forEach(el => { if(el) el.innerHTML = ''; });

            try {
                const res = await fetch(`https://api.github.com/repos/${G_REPO}/issues?labels=æ‹¼è½¦&state=open&t=${Date.now()}`);
                const issues = await res.json();
                
                let count = 0;
                issues.forEach(issue => {
                    const parts = issue.title.split('|').map(p => p.trim());
                    if(parts.length < 4) return;

                    const area = parts[0];
                    const resortName = parts[1]; // å¯¹åº”é›ªåœºåå­—
                    const time = parts[2];
                    const wechat = parts[3];

                    const card = `
                        <div class="bg-white/70 backdrop-blur-sm rounded-2xl p-4 border border-white flex justify-between items-center shadow-sm hover:shadow-md transition-all modal-enter">
                            <div>
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="bg-blue-600 text-white text-[9px] font-black px-1.5 py-0.5 rounded uppercase tracking-tighter">${area}å‡ºå‘</span>
                                </div>
                                <p class="text-sm font-black text-slate-700 italic">${time}</p>
                            </div>
                            <button onclick="contactOwner('${resortName}', '${wechat}')" class="bg-slate-900 text-white px-5 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-blue-600 transition-all">è”ç³»</button>
                        </div>
                    `;
                    
                    // æ™ºèƒ½åˆ†å‘åˆ°å¯¹åº”çš„ ID ä¸‹
                    if(sections[resortName]) {
                        sections[resortName].innerHTML += card;
                        count++;
                    }
                });

                // å¦‚æœæŸä¸ªé›ªåœºä¸‹æ²¡æ•°æ®ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
                Object.keys(sections).forEach(key => {
                    if(sections[key].innerHTML === '') {
                        sections[key].innerHTML = '<p class="text-[10px] text-slate-300 font-bold ml-4 py-2 uppercase tracking-widest">No active trips</p>';
                    }
                });

            } catch (e) {
                Object.values(sections).forEach(el => el.innerHTML = '<p class="text-[10px] text-red-300">æ•°æ®åŠ è½½å¤±è´¥</p>');
            }
        }

        window.onload = loadIssues;
    </script>
</body>
</html>
