<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkiWuhan - æ­¦æ±‰æ»‘é›ªæ‹¼è½¦åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .ski-blue { background: #1e40af; }
        .custom-shadow { box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.1); }
        .modal-enter { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        /* æ­£åœ¨åŠ è½½çš„è½¬åœˆåŠ¨ç”» */
        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #1e40af; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; vertical-align: middle; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">

    <nav class="ski-blue text-white p-4 sticky top-0 z-50 flex justify-between items-center shadow-lg">
        <h1 class="text-xl font-black italic tracking-tighter uppercase">SKI WUHAN ğŸ‚</h1>
        <button onclick="toggleModal('publish-modal')" class="bg-white text-blue-800 px-5 py-2 rounded-full text-xs font-black shadow-xl hover:bg-blue-50">
            + å‘å¸ƒæ‹¼è½¦
        </button>
    </nav>

    <main class="max-w-4xl mx-auto p-4 space-y-8 mt-4">
        <div class="text-center py-6">
            <h2 class="text-3xl font-black text-blue-900 mb-2 tracking-tight uppercase italic">Live Feed</h2>
            <p class="text-[10px] text-slate-400 font-bold tracking-[0.3em] uppercase">å®æ—¶åŒæ­¥ Â· è‡ªåŠ¨æ›´æ–°</p>
        </div>

        <div id="carpool-feed" class="grid gap-4">
            <div class="text-center py-10 text-slate-300">æ•°æ®åŠ è½½ä¸­...</div>
        </div>
    </main>

    <div id="publish-modal" class="hidden fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] w-full max-w-md p-8 modal-enter shadow-2xl relative">
            <button onclick="toggleModal('publish-modal')" class="absolute right-6 top-6 text-slate-300 hover:text-slate-900"><i class="fas fa-times text-xl"></i></button>
            <h3 class="text-2xl font-black mb-1 italic text-blue-900">Post a Trip</h3>
            <p class="text-[10px] text-slate-400 uppercase font-bold tracking-widest mb-6 border-b pb-4">å¡«å†™æ‚¨çš„è¡Œç¨‹ä¿¡æ¯</p>
            
            <form id="carpoolForm" class="space-y-4 text-left">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2">ç›®çš„åœ°é›ªåœº</label>
                    <select id="resort" class="w-full bg-slate-50 border-none rounded-2xl p-4 mt-1 text-sm focus:ring-2 focus:ring-blue-500">
                        <option>ç”˜éœ²å±±æ»‘é›ªåœº</option>
                        <option>WSçƒ­é›ªå¥‡è¿¹</option>
                        <option>ç»¿è‘±å¡æ»‘é›ªåœº</option>
                        <option>æ¡ƒèŠ±å†²æ»‘é›ªåœº</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2">å‡ºå‘åœ°</label>
                        <input type="text" id="area" placeholder="å¦‚ï¼šæ±Ÿå²¸åŒº" class="w-full bg-slate-50 border-none rounded-2xl p-4 mt-1 text-sm">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase ml-2">å¾®ä¿¡å·</label>
                        <input type="text" id="wechat" placeholder="å¿…å¡«" class="w-full bg-slate-50 border-none rounded-2xl p-4 mt-1 text-sm">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase ml-2">å‘è½¦æ—¶é—´/å¤‡æ³¨</label>
                    <input type="text" id="time" placeholder="å¦‚ï¼š1.27 08:30" class="w-full bg-slate-50 border-none rounded-2xl p-4 mt-1 text-sm">
                </div>
                <button type="button" id="submitBtn" onclick="submitForm()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg mt-4">
                    ç¡®è®¤å‘å¸ƒ
                </button>
            </form>
        </div>
    </div>

    <div id="contact-modal" class="hidden fixed inset-0 bg-black/60 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[2.5rem] w-full max-w-xs p-8 modal-enter shadow-2xl text-center">
            <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4">
                <i class="fab fa-weixin text-3xl"></i>
            </div>
            <h3 id="contact-name" class="font-black text-xl mb-1 text-slate-800">è½¦ä¸»å¾®ä¿¡</h3>
            <div class="bg-slate-50 py-4 px-2 rounded-2xl border-2 border-dashed border-slate-200 mb-6">
                <span id="contact-wx" class="text-2xl font-black text-blue-600 select-all tracking-tight"></span>
            </div>
            <button onclick="toggleModal('contact-modal')" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold text-xs uppercase">æˆ‘çŸ¥é“äº†</button>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒé…ç½®ï¼ˆè¯·å¡«å†™ä½ çš„ä¿¡æ¯ï¼‰ ---
        const G_TOKEN = "ä½ çš„Token"; // åˆšæ‰ç”Ÿæˆçš„ä»¥ ghp_ å¼€å¤´çš„å­—ç¬¦ä¸²
        const G_REPO = "yezhikk/ski"; 

        // 1. åˆ‡æ¢å¼¹çª—
        function toggleModal(id) {
            document.getElementById(id).classList.toggle('hidden');
        }

        // 2. æ˜¾ç¤ºå¾®ä¿¡
        function contactOwner(name, wx) {
            document.getElementById('contact-name').innerText = name;
            document.getElementById('contact-wx').innerText = wx;
            toggleModal('contact-modal');
        }

        // 3. é™é»˜æäº¤è¡¨å•åˆ° GitHub Issues
        async function submitForm() {
            const btn = document.getElementById('submitBtn');
            const resort = document.getElementById('resort').value;
            const area = document.getElementById('area').value;
            const wechat = document.getElementById('wechat').value;
            const time = document.getElementById('time').value;

            if(!wechat) { alert("è¯·å¡«å†™å¾®ä¿¡å·"); return; }

            btn.disabled = true;
            btn.innerHTML = '<span class="loader"></span> æ­£åœ¨åŒæ­¥æ•°æ®...';

            // æ„é€ æ ‡é¢˜æ ¼å¼ï¼šåŒºåŸŸ|é›ªåœº|æ—¶é—´|å¾®ä¿¡
            const title = `${area} | ${resort} | ${time} | ${wechat}`;

            try {
                const response = await fetch(`https://api.github.com/repos/${G_REPO}/issues`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `token ${G_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        labels: ['æ‹¼è½¦']
                    })
                });

                if (response.ok) {
                    alert('å‘å¸ƒæˆåŠŸï¼ç³»ç»Ÿå·²è‡ªåŠ¨åŒæ­¥ã€‚');
                    toggleModal('publish-modal');
                    loadIssues(); // é‡æ–°åŠ è½½åˆ—è¡¨
                } else {
                    throw new Error('æäº¤å¤±è´¥');
                }
            } catch (err) {
                alert('æœåŠ¡å™¨ç¹å¿™ï¼Œè¯·ç¨åå†è¯•ã€‚');
            } finally {
                btn.disabled = false;
                btn.innerText = 'ç¡®è®¤å‘å¸ƒ';
            }
        }

        // 4. è‡ªåŠ¨ä» GitHub è¯»å–å¹¶ç”Ÿæˆå¡ç‰‡
        async function loadIssues() {
            const container = document.getElementById('carpool-feed');
            try {
                const res = await fetch(`https://api.github.com/repos/${G_REPO}/issues?labels=æ‹¼è½¦&state=open`);
                const issues = await res.json();
                
                if (issues.length === 0) {
                    container.innerHTML = '<div class="text-center py-20 text-slate-300 italic">æš‚æ— è¡Œç¨‹ï¼Œç‚¹å‡»ä¸Šæ–¹å‘å¸ƒç¬¬ä¸€ä¸ªè¡Œç¨‹</div>';
                    return;
                }

                container.innerHTML = '';
                issues.forEach(issue => {
                    const parts = issue.title.split('|').map(p => p.trim());
                    if(parts.length < 4) return;

                    const card = `
                        <div class="bg-white rounded-3xl p-6 custom-shadow border border-slate-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 card-enter">
                            <div class="space-y-1">
                                <div class="flex items-center gap-2">
                                    <span class="bg-blue-100 text-blue-700 text-[10px] font-black px-2 py-0.5 rounded-md">${parts[0]}å‡ºå‘</span>
                                    <h3 class="font-bold text-lg text-slate-800">${parts[1]}</h3>
                                </div>
                                <p class="text-sm font-medium text-slate-500 italic">${parts[2]}</p>
                                <p class="text-xs text-slate-400 font-bold uppercase tracking-widest">Active Now</p>
                            </div>
                            <button onclick="contactOwner('${parts[1]}è½¦ä¸»', '${parts[3]}')" class="w-full md:w-auto bg-slate-900 text-white px-8 py-3 rounded-2xl text-xs font-black hover:bg-blue-600 transition-all shadow-lg">
                                è”ç³»è½¦ä¸»
                            </button>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            } catch (e) {
                container.innerHTML = '<div class="text-center py-10 text-red-300">æ•°æ®åŠ è½½å¤±è´¥</div>';
            }
        }

        window.onload = loadIssues;
    </script>
</body>
</html>
