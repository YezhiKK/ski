<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkiWuhan | 2026 拼车看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        
        /* 顶部动画背景 */
        .header-gradient { 
            background: linear-gradient(135deg, #0f172a 0%, #1e40af 100%); 
            position: relative; overflow: hidden;
        }
        .snow-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
            opacity: 0.3; animation: snowMove 20s linear infinite;
        }
        @keyframes snowMove { from { background-position: 0 0; } to { background-position: 500px 1000px; } }

        /* 卡片设计 */
        .cornell-card { 
            border-radius: 2.5rem; background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px); transition: all 0.4s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
        }
        .cornell-card:hover { transform: translateY(-6px); box-shadow: 0 25px 30px -10px rgba(0, 0, 0, 0.1); }
        
        /* 日历图标 */
        .date-box {
            background: #e2e8f0; border-radius: 12px;
            width: 45px; height: 45px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; flex-shrink: 0;
        }

        /* 剩余座位标签 */
        .seat-badge {
            background: #1e40af; color: white; padding: 2px 10px;
            border-radius: 99px; font-size: 10px; font-weight: 900;
        }

        .loader { border: 2px solid #f3f3f3; border-top: 2px solid #1e40af; border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="text-slate-900">

    <header class="header-gradient text-white pt-20 pb-32 px-6 text-center">
        <div class="snow-overlay"></div>
        <div class="relative z-10">
            <i class="fas fa-snowflake text-4xl mb-4 animate-spin-slow opacity-80"></i>
            <h1 class="text-5xl font-black italic tracking-tighter mb-3 uppercase">Ski Wuhan</h1>
            <p class="text-blue-100/60 text-[10px] font-bold tracking-[0.4em] uppercase"> 滑雪拼车 · 极简社区 · 2026 </p>
            <button onclick="toggleModal('publish-modal')" class="mt-10 bg-white text-blue-900 px-12 py-4 rounded-2xl font-black shadow-2xl hover:scale-105 transition-all active:scale-95 flex items-center gap-2 mx-auto">
                <i class="fas fa-paper-plane"></i> 发帖招募
            </button>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 -mt-16 pb-24 space-y-20 relative z-20">

        <section>
            <div class="flex items-center gap-3 mb-8 ml-4">
                <div class="p-2 bg-green-100 rounded-lg text-green-600"><i class="fas fa-hause"></i></div>
                <h2 class="text-2xl font-black text-slate-800 italic uppercase">室内雪场 / Indoor</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="cornell-card p-8"><h3 class="text-xl font-black mb-1">甘露山滑雪场</h3><p class="text-[10px] text-slate-400 font-bold mb-6">武汉·黄陂</p><div id="feed-甘露山滑雪场" class="space-y-4"></div></div>
                <div class="cornell-card p-8"><h3 class="text-xl font-black mb-1">WS热雪奇迹</h3><p class="text-[10px] text-slate-400 font-bold mb-6">武汉·武昌</p><div id="feed-WS热雪奇迹" class="space-y-4"></div></div>
                <div class="cornell-card p-8"><h3 class="text-xl font-black mb-1">武汉冰雪中心</h3><p class="text-[10px] text-slate-400 font-bold mb-6">武汉·经开</p><div id="feed-武汉冰雪中心" class="space-y-4"></div></div>
            </div>
        </section>

        <section>
            <div class="flex items-center gap-3 mb-8 ml-4">
                <div class="p-2 bg-blue-100 rounded-lg text-blue-600"><i class="fas fa-mountain"></i></div>
                <h2 class="text-2xl font-black text-slate-800 italic uppercase">室外雪场 / Outdoor</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="cornell-card p-8 border-t-8 border-blue-500"><h3 class="text-xl font-black mb-1">绿葱坡滑雪场</h3><p class="text-[10px] text-slate-400 font-bold mb-6">恩施·巴东</p><div id="feed-绿葱坡滑雪场" class="space-y-4"></div></div>
                <div class="cornell-card p-8 border-t-8 border-blue-500"><h3 class="text-xl font-black mb-1">桃花冲滑雪场</h3><p class="text-[10px] text-slate-400 font-bold mb-6">黄冈·英山</p><div id="feed-桃花冲滑雪场" class="space-y-4"></div></div>
                <div class="cornell-card p-8 border-t-8 border-blue-500"><h3 class="text-xl font-black mb-1">伏牛山滑雪场</h3><p class="text-[10px] text-slate-400 font-bold mb-6">洛阳·栾川</p><div id="feed-伏牛山滑雪场" class="space-y-4"></div></div>
            </div>
        </section>
    </main>

    <div id="publish-modal" class="hidden fixed inset-0 bg-slate-900/80 z-[100] flex items-center justify-center p-4 backdrop-blur-md">
        <div class="bg-white rounded-[3rem] w-full max-w-md p-10 shadow-2xl relative">
            <h3 class="text-2xl font-black mb-8 italic text-slate-800">发布行程</h3>
            <form id="carpoolForm" class="space-y-4">
                <select id="resort" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold">
                    <option>甘露山滑雪场</option><option>WS热雪奇迹</option><option>武汉冰雪中心</option>
                    <option>绿葱坡滑雪场</option><option>桃花冲滑雪场</option><option>伏牛山滑雪场</option>
                </select>
                <div class="grid grid-cols-2 gap-4">
                    <input type="text" id="area" placeholder="出发地区" class="bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold">
                    <select id="seats" class="bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold">
                        <option value="1座">剩 1 座</option><option value="2座">剩 2 座</option>
                        <option value="3座">剩 3 座</option><option value="4座+">4座以上</option>
                    </select>
                </div>
                <input type="text" id="wechat" placeholder="微信号" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold">
                <input type="text" id="time" placeholder="日期时间 (如: 1.28 周六 08:30)" class="w-full bg-slate-50 border-none rounded-2xl p-4 text-sm font-bold">
                <button type="button" onclick="submitForm()" id="submitBtn" class="w-full bg-blue-700 text-white py-5 rounded-2xl font-black shadow-xl mt-4">确认发布</button>
                <button type="button" onclick="toggleModal('publish-modal')" class="w-full text-slate-400 font-bold text-xs uppercase mt-2">取消</button>
            </form>
        </div>
    </div>

    <div id="contact-modal" class="hidden fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-[3rem] w-full max-w-xs p-10 text-center shadow-2xl">
            <div class="w-16 h-16 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-6"><i class="fab fa-weixin text-3xl"></i></div>
            <h3 id="contact-name" class="font-black text-xl mb-2 italic tracking-tighter">Driver WeChat</h3>
            <span id="contact-wx" class="text-2xl font-black text-blue-700 select-all block mb-8 underline decoration-blue-200 underline-offset-8"></span>
            <button onclick="toggleModal('contact-modal')" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold text-xs">CLOSE</button>
        </div>
    </div>

    <script>
        // --- 请反转填入你的 Token ---
        const secret = "这里反着填Token"; 
        const G_TOKEN = secret.split("").reverse().join("");
        const G_REPO = "yezhikk/ski"; 

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }

        async function submitForm() {
            const btn = document.getElementById('submitBtn');
            const resort = document.getElementById('resort').value;
            const area = document.getElementById('area').value;
            const wechat = document.getElementById('wechat').value;
            const time = document.getElementById('time').value;
            const seats = document.getElementById('seats').value;

            if(!wechat || !time) { alert("请填写完整信息"); return; }
            btn.disabled = true;
            btn.innerHTML = '<span class="loader mx-auto"></span>';

            // 标题格式：区域 | 雪场 | 时间 | 微信 | 座位
            const title = `${area} | ${resort} | ${time} | ${wechat} | ${seats}`;

            try {
                const response = await fetch(`https://api.github.com/repos/${G_REPO}/issues`, {
                    method: 'POST',
                    headers: { 'Authorization': `token ${G_TOKEN}`, 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: title, labels: ['拼车'] })
                });
                if (response.ok) { toggleModal('publish-modal'); loadIssues(); }
            } catch (err) { alert('同步失败'); }
            finally { btn.disabled = false; btn.innerText = '确认发布'; }
        }

        async function loadIssues() {
            const resorts = ['甘露山滑雪场', 'WS热雪奇迹', '武汉冰雪中心', '绿葱坡滑雪场', '桃花冲滑雪场', '伏牛山滑雪场'];
            resorts.forEach(r => { 
                const el = document.getElementById(`feed-${r}`);
                if(el) el.innerHTML = '<p class="text-[9px] text-slate-300 font-bold animate-pulse">LOADING...</p>'; 
            });

            try {
                const res = await fetch(`https://api.github.com/repos/${G_REPO}/issues?labels=拼车&state=open&t=${Date.now()}`);
                const issues = await res.json();
                
                resorts.forEach(r => { document.getElementById(`feed-${r}`).innerHTML = ''; });

                issues.forEach(issue => {
                    const parts = issue.title.split('|').map(p => p.trim());
                    if(parts.length < 4) return;
                    const [area, resortName, time, wechat, seats] = parts;
                    
                    // 提取日期前两个字符（如 1.28 -> 1.）作为图标展示
                    const dateDisplay = time.substring(0, 4);

                    const card = `
                        <div class="trip-card bg-slate-50 p-4 rounded-3xl flex items-center gap-4 hover:bg-white border border-transparent hover:border-slate-200 transition-all group">
                            <div class="date-box">
                                <span class="text-[8px] font-black text-slate-400 uppercase">Jan</span>
                                <span class="text-sm font-black text-blue-600">${dateDisplay}</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-0.5">
                                    <span class="seat-badge uppercase italic">${seats || '有位'}</span>
                                    <span class="text-[9px] font-bold text-slate-400 uppercase">${area}</span>
                                </div>
                                <p class="text-[13px] font-black text-slate-700 leading-none">${time.substring(4)}</p>
                            </div>
                            <button onclick="contactOwner('${resortName}', '${wechat}')" class="w-10 h-10 rounded-full bg-white border border-slate-200 text-slate-400 hover:bg-slate-900 hover:text-white transition-all flex items-center justify-center">
                                <i class="fas fa-comment-dots text-sm"></i>
                            </button>
                        </div>
                    `;
                    const container = document.getElementById(`feed-${resortName}`);
                    if(container) container.innerHTML += card;
                });

                resorts.forEach(r => {
                    const el = document.getElementById(`feed-${r}`);
                    if(el.innerHTML === '') el.innerHTML = '<p class="text-[9px] text-slate-200 font-bold text-center py-4">NO TRIPS YET</p>';
                });
            } catch (e) { console.error(e); }
        }
        window.onload = loadIssues;
    </script>
</body>
</html>
